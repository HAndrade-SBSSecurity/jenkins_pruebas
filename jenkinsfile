pipeline {
    agent {
        label 'WindowsAgent'
    }
    triggers {
        cron('*/2 * * * *') // Se ejecuta cada 20 minutos
    }
    environment {
        EXECUTED_THIS_HOUR = false
    }
    stages {
        stage('Son las 15 hrs "do"') {
            when {
                expression {
                    def currentHour = new Date().format("HH").toInteger()
                    def currentMinute = new Date().format("mm").toInteger()
                    def executedThisHour = env.EXECUTED_THIS_HOUR ?: false

                    if (currentHour == 15 && !executedThisHour) {
                        env.EXECUTED_THIS_HOUR = true
                        return true
                    } else {
                        return false
                    }
                }
            }
            steps {
                script {
                    bat 'python do.py'
                }
            }
        }
        stage('Son las 14 hrs "to do"') {
            when {
                expression {
                    return new Date().format("HH").toInteger() == 14 && new Date().format("mm").toInteger() < 20
                }
            }
            steps {
                script {
                    bat 'python to_do.py'
                }
            }
        }
    }
}